<!DOCTYPE html>
<html lang="hi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 500px;
            padding: 40px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input[type="text"],
        input[type="password"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .gender-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .gender-option {
            flex: 1;
            position: relative;
        }

        .gender-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .gender-option label {
            display: block;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .gender-option input[type="radio"]:checked+label {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .password-help {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .whatsapp-btn {
            background: #25D366;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            text-decoration: none;
            display: inline-block;
            font-weight: 600;
            transition: all 0.3s;
        }

        .whatsapp-btn:hover {
            background: #20BA5A;
            transform: translateY(-2px);
        }

        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 28px 20px;
            border-radius: 18px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        /* subtle glow effect */
        .profile-header::before {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 60%);
            transform: rotate(25deg);
        }

        /* content wrapper */
        .profile-content {
            position: relative;
            z-index: 2;
        }

        /* Welcome text */
        .profile-content h2 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 18px;
            /* üëà space before logout */
        }

        /* Smaller centered logout button */
        .logout-btn {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(6px);
            border: 1px solid rgba(255, 255, 255, 0.35);
            padding: 6px 18px;
            /* üëà compact */
            border-radius: 10px;
            font-size: 13px;
            /* üëà smaller text */
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .logout-btn:hover {
            background: white;
            color: #764ba2;
            transform: translateY(-2px);
        }

        .categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .category-btn {
            padding: 20px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
            color: #333;
        }

        .category-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .pdf-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .pdf-item {
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .pdf-item:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px 20px;
            gap: 15px;
        }

        .loader-spinner {
            width: 45px;
            height: 45px;
            border: 4px solid #e0e0e0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.6;
            }
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
        }

        .pdf-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: none;
        }

        .pdf-viewer.active {
            display: flex;
            flex-direction: column;
        }

        .pdf-controls {
            background: #333;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pdf-controls button {
            width: auto;
            padding: 10px 20px;
            margin: 0 5px;
        }

        .close-btn {
            background: #c33;
        }

        .pdf-frame {
            flex: 1;
            border: none;
            background: white;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Page 1: Registration -->
        <div id="page1" class="page active">
            <h1>üìö Student Registration</h1>
            <form id="registrationForm">
                <div class="form-group">
                    <label for="name">‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                    <input type="text" id="name" required placeholder="‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç">
                </div>

                <div class="form-group">
                    <label>Gender</label>
                    <div class="gender-group">
                        <div class="gender-option">
                            <input type="radio" id="boy" name="gender" value="Boy" required>
                            <label for="boy">üë® Boy</label>
                        </div>
                        <div class="gender-option">
                            <input type="radio" id="girl" name="gender" value="Girl" required>
                            <label for="girl">üë© Girl</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="whatsapp">WhatsApp Number</label>
                    <input type="text" id="whatsapp" required placeholder="10 digits ‡§Ø‡§æ +91 ‡§ï‡•á ‡§∏‡§æ‡§•"
                        pattern="(\+91)?[0-9]{10}">
                </div>

                <p style="text-align:right; margin-bottom:15px;">
                    <a href="#" id="whyDataLink" style="color:#667eea; font-weight:600; text-decoration:none;">
                        ‚ùì Why we ask data?
                    </a>
                </p>


                <button type="submit" id="nextBtn">Next ‚Üí</button>
            </form>
        </div>

        <!-- Page 2: Password -->
        <div id="page2" class="page">
            <h1>üîê Password Entry</h1>
            <form id="passwordForm">
                <div class="form-group">
                    <label for="password">Password ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</label>
                    <input type="password" id="password" required placeholder="Password">
                </div>

                <button type="submit" id="verifyBtn">Verify Password</button>

                <div class="password-help">
                    <p style="margin-bottom: 10px; color: #666; font-weight: 600;">‚ö†Ô∏è Password ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§Ø‡§æ Wrong ‡§¨‡§§‡§æ ‡§∞‡§π‡§æ
                        ‡§π‡•à?</p>
                    <p style="margin-bottom: 15px; color: #333; font-size: 15px;">‡§§‡•ã ‡§®‡•Ä‡§ö‡•á üëá <strong>Green
                            Button</strong> ‡§™‡§∞ Click ‡§ï‡§∞‡•á‡§Ç</p>
                    <a href="#" class="whatsapp-btn" id="getPasswordBtn">
                        Click Here to Get Password
                    </a>
                </div>

                <div id="error" class="error" style="display: none;"></div>
            </form>
        </div>

        <!-- Page 3: Dashboard -->
        <div id="page3" class="page">

            <div class="profile-header" id="profileHeader" style="display:none;">
                <div class="profile-content">
                    <h2 id="userName">Welcome!</h2>
                    <button class="logout-btn" id="logoutBtn">Logout</button>
                </div>
            </div>

            <h1>üìñ Study Material</h1>

            <div class="categories">
                <div class="category-btn active" data-category="books">
                    üìö UPSC PYQs Eng Book (Click Here)
                </div>
            </div>

            <div id="pdfList" class="pdf-list">
                <div class="loading">Loading...</div>
            </div>

        </div>
    </div>
    </div>
    <!-- ================= DATA INFO MODAL ================= -->

    <div id="dataModal" style="
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.7);
    z-index:2000;
    justify-content:center;
    align-items:center;
">

        <div style="
        background:white;
        width:90%;
        max-width:500px;
        padding:30px;
        border-radius:15px;
        position:relative;
        animation:slideIn 0.3s ease;
    ">

            <button id="closeDataModal" style="
    position:absolute;
    top:12px;
    right:12px;
    width:36px;
    height:36px;
    border:none;
    border-radius:50%;
    background:#e53935;
    color:white;
    font-size:18px;
    font-weight:bold;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:all 0.3s ease;
">
                &times;
            </button>

            <h2 style="color:#667eea; margin-bottom:15px;">Why We Ask Your Data?</h2>

            <p style="margin-bottom:15px; line-height:1.6;">
                <strong>English:</strong><br>
                If we directly share PDFs, we are unable to track how many students are accessing or downloading them.
                Therefore, this system has been created to understand how many students are using the study materials.
                Your name and mobile number are stored only for monitoring usage.
                All data will be automatically deleted within 1 month to 1 year.
                No data is stored permanently.
            </p>

            <p style="line-height:1.6;">
                <strong>‡§π‡§ø‡§Ç‡§¶‡•Ä:</strong><br>
                ‡§Ø‡§¶‡§ø ‡§π‡§Æ ‡§∏‡•Ä‡§ß‡•á PDF ‡§≠‡•á‡§ú ‡§¶‡•á‡§Ç ‡§§‡•ã ‡§π‡§Æ ‡§Ø‡§π ‡§ü‡•ç‡§∞‡•à‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§™‡§æ‡§§‡•á ‡§ï‡§ø ‡§ï‡§ø‡§§‡§®‡•á ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä PDF ‡§¶‡•á‡§ñ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç ‡§Ø‡§æ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞
                ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§
                ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ø‡§π ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§¨‡§®‡§æ‡§à ‡§ó‡§à ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§π‡§Æ‡•á‡§Ç ‡§™‡§§‡§æ ‡§ö‡§≤ ‡§∏‡§ï‡•á ‡§ï‡§ø ‡§ï‡§ø‡§§‡§®‡•á ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§
                ‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§ï‡•á‡§µ‡§≤ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•Ä ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∞‡§ñ‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§
                ‡§Ü‡§™‡§ï‡§æ ‡§°‡•á‡§ü‡§æ 1 ‡§Æ‡§æ‡§π ‡§∏‡•á 1 ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•á ‡§≠‡•Ä‡§§‡§∞ ‡§∏‡•ç‡§µ‡§§‡§É ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§
                ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§∞‡§ñ‡§æ ‡§ú‡§æ‡§§‡§æ‡•§
            </p>

        </div>
    </div>
    <!-- PDF Viewer -->
    <div id="pdfViewer" class="pdf-viewer">
        <div class="pdf-controls">
            <h3 style="color: white; margin: 0;" id="pdfTitle">Document</h3>
            <button class="close-btn" id="closePdfBtn">‚úï Close</button>
        </div>
        <iframe id="pdfFrame" class="pdf-frame"></iframe>
    </div>

    <script>

        // ================= CONFIG =================

        const CONFIG = {
            PASSWORD_API: 'https://script.google.com/macros/s/AKfycbwEw6UethfpV3yYBcPi5Hn_hrqMuO7KPGAwvsHwmZ8UsKgyX55j-AM916frwHveOoXK1w/exec',
            PDF_API: 'https://script.google.com/macros/s/AKfycbz-EQTydFs5lZ_eQRYyGXwVo6FKIjqIZyrHKPDfhRnJjkxkjsGrV74VahHMi-6wh5Szpw/exec'
        };


        // ================= STATE =================
        let isVerified = false;
        let pendingPDF = null;

        let userData = {
            name: '',
            gender: '',
            whatsapp: ''
        };

        let currentCategory = 'books';
        let userLeftTracked = false;

        showPage('page3');
        loadPDFs(currentCategory);
        // ================= TEXT TO SPEECH =================

        function speak(text) {
            window.speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'hi-IN';
            utterance.rate = 0.9;
            utterance.pitch = 1.2;

            window.speechSynthesis.speak(utterance);
        }

        // ================= REGISTRATION =================

        document.getElementById('registrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const nextBtn = document.getElementById('nextBtn');
            nextBtn.disabled = true;
            nextBtn.textContent = 'Processing...';

            userData.name = document.getElementById('name').value;
            userData.gender = document.querySelector('input[name="gender"]:checked').value;
            let whatsappNumber = document.getElementById('whatsapp').value;
            whatsappNumber = whatsappNumber.replace(/^\+91/, '');
            userData.whatsapp = whatsappNumber;

            await saveStudentData();

            await new Promise(resolve => setTimeout(resolve, 2000));

            userLeftTracked = false;
            trackPasswordPageVisit();

            nextBtn.disabled = false;
            nextBtn.textContent = 'Next ‚Üí';

            showPage('page2');
        });

        // ================= PASSWORD PAGE TRACKING =================

        async function trackPasswordPageVisit() {
            await fetch(CONFIG.PASSWORD_API, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({
                    action: 'reachedPasswordPage',
                    gender: userData.gender,
                    name: userData.name,
                    mobile: userData.whatsapp
                })
            });
        }

        async function trackUserLeft() {
            if (!userLeftTracked) {
                userLeftTracked = true;

                await fetch(CONFIG.PASSWORD_API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'leftWithoutPassword',
                        gender: userData.gender,
                        name: userData.name,
                        mobile: userData.whatsapp
                    })
                });
            }
        }

        // ================= PASSWORD VERIFY =================

        document.getElementById('passwordForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const password = document.getElementById('password').value;
            const verifyBtn = document.getElementById('verifyBtn');
            const errorDiv = document.getElementById('error');

            verifyBtn.disabled = true;
            verifyBtn.textContent = 'Verifying...';
            errorDiv.style.display = 'none';

            try {

                const response = await fetch(CONFIG.PASSWORD_API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'verifyPassword',
                        gender: userData.gender,
                        password: password,
                        name: userData.name,
                        mobile: userData.whatsapp
                    })
                });

                const result = await response.json();

                if (result.success) {

                    isVerified = true;
                    document.getElementById("profileHeader").style.display = "block";
                    showPage('page3');
                    loadDashboard();

                    // If user originally clicked a PDF
                    if (pendingPDF) {
                        const temp = pendingPDF;
                        pendingPDF = null;
                        openPDF(temp.url, temp.name);
                    }
                } else {
                    errorDiv.textContent = 'Incorrect Password! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä password ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§';
                    errorDiv.style.display = 'block';
                    verifyBtn.disabled = false;
                    verifyBtn.textContent = 'Verify Password';
                    speak('‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°‡•§ ‡§®‡•Ä‡§ö‡•á ‡§π‡§∞‡•á ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§');
                }

            } catch (error) {
                errorDiv.textContent = 'Connection Error!';
                errorDiv.style.display = 'block';
                verifyBtn.disabled = false;
                verifyBtn.textContent = 'Verify Password';
            }
        });

        // ================= SAVE STUDENT =================

        async function saveStudentData() {
            await fetch(CONFIG.PASSWORD_API, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({
                    action: 'saveStudent',
                    name: userData.name,
                    gender: userData.gender,
                    whatsapp: userData.whatsapp
                })
            });
        }

        // ================= DASHBOARD =================

        function loadDashboard() {
            document.getElementById('userName').textContent = `Welcome, ${userData.name}! üëã`;
            loadPDFs(currentCategory);
        }

        // ================= CATEGORY =================

        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {

                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                currentCategory = btn.dataset.category;

                // üîî CATEGORY NOTIFY
                fetch(
                    CONFIG.PASSWORD_API +
                    "?action=notifyPDF" +
                    "&name=" + encodeURIComponent(userData.name) +
                    "&gender=" + encodeURIComponent(userData.gender) +
                    "&pdfName=Category Click" +
                    "&category=" + encodeURIComponent(currentCategory)
                );

                loadPDFs(currentCategory);
            });
        });
        // ================= LOAD PDFs =================

        async function loadPDFs(category) {

            const pdfList = document.getElementById('pdfList');
            pdfList.innerHTML = `
    <div class="loading">
        <div class="loader-spinner"></div>
        <div class="loading-text">Loading PDFs...</div>
    </div>
`;

            try {

                const response = await fetch(`${CONFIG.PDF_API}?action=getPDFs&category=${category}`);
                const data = await response.json();

                if (data.pdfs && data.pdfs.length > 0) {

                    pdfList.innerHTML = data.pdfs.map(pdf => `
                <div class="pdf-item" data-url="${pdf.url}" data-name="${pdf.name}">
                    üìÑ ${pdf.name}
                </div>
            `).join('');

                    document.querySelectorAll('.pdf-item').forEach(item => {
                        item.addEventListener('click', () => {
                            openPDF(item.dataset.url, item.dataset.name);
                        });
                    });

                } else {
                    pdfList.innerHTML = '<p style="text-align:center;color:#999;">No PDFs available</p>';
                }

            } catch (error) {
                pdfList.innerHTML = '<p style="text-align:center;color:#c33;">Error loading PDFs</p>';
            }
        }

        // ================= OPEN PDF =================

        function openPDF(url, name) {

            if (!isVerified) {
                pendingPDF = { url, name };
                showPage('page1');
                return;
            }

            const viewer = document.getElementById('pdfViewer');
            const frame = document.getElementById('pdfFrame');
            const title = document.getElementById('pdfTitle');

            const viewUrl = url.replace('/view', '/preview');

            title.textContent = name;
            frame.src = viewUrl;
            viewer.classList.add('active');

            sendPdfNotification(name);
        }

        // ================= PDF NOTIFICATION =================

        async function sendPdfNotification(pdfName) {
            await fetch(
                CONFIG.PASSWORD_API +
                "?action=notifyPDF" +
                "&name=" + encodeURIComponent(userData.name) +
                "&gender=" + encodeURIComponent(userData.gender) +
                "&pdfName=" + encodeURIComponent(pdfName) +
                "&category=" + encodeURIComponent(currentCategory)
            );
        }

        // ================= CLOSE PDF =================

        document.getElementById('closePdfBtn').addEventListener('click', () => {
            document.getElementById('pdfViewer').classList.remove('active');
            document.getElementById('pdfFrame').src = '';
        });

        // ================= LOGOUT =================

        document.getElementById('logoutBtn').addEventListener('click', () => {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ logout ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {

                isVerified = false;
                pendingPDF = null;

                document.getElementById("profileHeader").style.display = "none";

                showPage('page1');
                document.getElementById('registrationForm').reset();
            }
        });

        // ================= PAGE HELPER =================

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        // ================= DATA MODAL =================

        const dataModal = document.getElementById('dataModal');
        const whyDataLink = document.getElementById('whyDataLink');
        const closeDataModal = document.getElementById('closeDataModal');

        document.addEventListener("click", function (e) {
            if (e.target && e.target.id === "whyDataLink") {
                e.preventDefault();
                dataModal.style.display = "flex";
            }
        });
        closeDataModal.addEventListener('click', () => {
            dataModal.style.display = "none";
        });

        // Close when clicking outside box
        dataModal.addEventListener('click', (e) => {
            if (e.target === dataModal) {
                dataModal.style.display = "none";
            }
        });

    </script>
</body>

</html>
